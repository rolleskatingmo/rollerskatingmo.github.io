<!doctype html>
<html lang="zh-TW">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>測試點名系統</title>
        <meta name="theme-color" content="3B4252" />
        <style>
            h1 {
                color: var(--nord7);
            }

            body {
                background-color: var(--nord0);
            }

            body {
                --nord0: #2e3440;
                --nord1: #3b4252;
                --nord2: #434c5e;
                --nord3: #4c566a;
                --nord4: #d8dee9;
                --nord5: #e5e9f0;
                --nord6: #eceff4;
                --nord7: #8fbcbb;
                --nord8: #88c0d0;
                --nord9: #81a1c1;
                --nord10: #5e81ac;
                --nord11: #bf616a;
                --nord12: #d08770;
                --nord13: #ebcb8b;
                --nord14: #a3be8c;
                --nord15: #b48ead;
                --black: #000;
                --line: #4c566a;
            }

            main, nav {
                display: flex;
            }

            .call button,
            button:hover {
                background-color: var(--nord2);
            }

            button, section > div {
                background-color: var(--nord1);
                box-shadow: rgba(0, 0, 0, 0.2) 0 0 0.5rem;
            }

            main, section > div {
                padding: 1rem;
                width: 100%;
            }

            footer, footer a {
                color: var(--nord4);
            }

            .search button, button, input, section > div {
                box-shadow: rgba(0, 0, 0, 0.2) 0 0 0.5rem;
            }

            body, button, h2, html {
                text-align: center;
            }

            * {
                padding: 0;
                margin: 0;
                box-sizing: border-box;
                font-family: Arial, "微軟正黑體", Helvetica, sans-serif;
                color: var(--nord6);
            }

            body, html {
                min-height: 100%;
            }

            main {
                flex-direction: column;
                height: 100vh;
                height: 100dvh;
                max-width: 500px;
                margin: 0 auto;
            }

            nav {
                justify-content: space-between;
            }

            button {
                display: block;
                height: 50px;
                width: calc(1 / 3 * 100% - 1rem);
                line-height: 50px;
                border-radius: 1rem;
                text-decoration: none;
                border: none;
                cursor: pointer;
                transition: background-color 0.2s ease-in-out;
            }

            #call, .search, footer {
                display: flex;
            }

            .call button {
                width: calc(1 / 4 * 100% - 1rem);
                margin: 0.5rem;
            }

            button:hover {
                filter: brightness(1.2);
            }

            button:active {
                background-color: var(--nord3);
                filter: brightness(1.5);
            }

            section {
                flex-grow: 1;
                margin: 1rem 0;
                position: relative;
            }

            footer {
                justify-content: flex-end;
                align-items: flex-end;
            }

            section > div {
                border-radius: 1rem;
                overflow-x: hidden;
                overflow-y: auto;
                position: absolute;
                height: 100%;
                transition: opacity 0.5s ease-in-out;
            }

            #add, #history {
                opacity: 0;
            }

            #call {
                z-index: 2;
                flex-wrap: wrap;
                justify-content: space-between;
            }

            .search {
                justify-content: center;
                align-items: center;
            }

            .search button, input {
                height: 2rem;
                width: 50%;
                border-radius: 0.5rem;
                border: transparent;
                padding: 0 1rem;
                background-color: var(--nord3);
                color: var(--nord4);
            }

            h2, table {
                width: 100%;
            }

            input:focus {
                outline: transparent;
            }

            .search button {
                margin-left: 1rem;
                width: auto;
                line-height: 100%;
            }

            table {
                border-collapse: collapse;
                margin-top: 1rem;
            }

            tr {
                border-bottom: 1px solid var(--line);
            }

            td {
                padding: 0.5rem;
            }

            h2 {
                margin-top: 2rem;
                font-weight: 600;
            }

            #status {
                margin: 0.5rem 0 1rem;
                color: var(--nord13);
                font-size: 1.3rem;
            }
        </style>
    </head>

    <body>
        <main>
            <h1>測試點名系統</h1>
            <h2 id="status">歡迎使用</h2>
            <nav>
                <button onclick="searchA()">查詢紀錄</button>
                <button onclick="callA()">點名</button>
                <button onclick="addA()">新增學生</button>
                <button onclick="classSwitch()">調課</button>
            </nav>
            <section>
                <div id="history">
                    <div class="search">
                        <input type="text" placeholder="輸入學生姓名查詢" id="search-name" />
                        <button onclick="searchStudent()">查詢課堂及請假次數</button>
                    </div>
                    <div id="student-info"></div>
                    <table>
                        <thead>
                            <tr>
                                <td>時間</td>
                                <td>剩下課堂</td>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div id="call">
                    <h2>載入中</h2>
                </div>
                <div id="add">
                    <div class="search">
                        <input type="text" id="add-name" placeholder="輸入學生姓名" />
                        <select id="class-select">
                            <option value="A1">A1</option>
                            <option value="A2">A2</option>
                            <option value="A3">A3</option>
                            <option value="A4">A4</option>
                            <option value="B1">B1</option>
                            <option value="B2">B2</option>
                            <option value="B3">B3</option>
                            <option value="B4">B4</option>
                            <option value="B5">B5</option>
                            <option value="B6">B6</option>
                            <option value="C1">C1</option>
                            <option value="C2">C2</option>
                        </select>
                        <button onclick="addStudent()">新增</button>
                    </div>
                </div>
                <div id="leave">
                    <div class="search">
                        <input type="text" id="leave-name" placeholder="請假學生姓名" />
                        <button onclick="leaveStudent()">請假</button>
                    </div>
                </div>
                <div id="switch">
                    <div class="search">
                        <input type="text" id="switch-name" placeholder="輸入學生姓名" />
                        <select id="switch-class">
                            <option value="A1">A1</option>
                            <option value="A2">A2</option>
                            <option value="A3">A3</option>
                            <option value="A4">A4</option>
                            <option value="B1">B1</option>
                            <option value="B2">B2</option>
                            <option value="B3">B3</option>
                            <option value="B4">B4</option>
                            <option value="B5">B5</option>
                            <option value="B6">B6</option>
                            <option value="C1">C1</option>
                            <option value="C2">C2</option>
                        </select>
                        <button onclick="switchClass()">調課</button>
                    </div>
                </div>
            </section>
            <footer>
                <a href="edit-mr.github.io/">毛哥EM</a>製作 |
                <a href="https://emtech.cc/post/roll-call">教學</a>
            </footer>
        </main>
        <script>
            var url =
                "https://script.google.com/macros/s/AKfycbx4_OeZtQ35WA-fvALW4IQDyWHmKfW8vryvtY_c7e6ZbHyJ5S5Tv8510q3211QaCGKu/exec";

            const [history, call, add, leave, switchSection] = ["history", "call", "add", "leave", "switch"].map((t) =>
                    document.getElementById(t)
                );

            // 新增學生
            function addStudent() {
                let name = document.getElementById("add-name").value;
                let className = document.getElementById("class-select").value;
                if (name) {
                    fetch(url + `?type=new&name=${encodeURIComponent(name)}&class=${className}`)
                        .then((response) => {
                            if (response.ok) {
                                alert(`${name} 已成功加入 ${className} 班！`);
                            } else {
                                alert(`新增失敗`);
                            }
                        })
                        .catch((error) => {
                            alert("新增學生錯誤：" + error);
                        });
                } else {
                    alert("請輸入學生姓名！");
                }
            }

            // 查詢學生剩餘課堂數和請假次數
            function searchStudent() {
                let name = document.getElementById("search-name").value;
                if (name) {
                    fetch(url + `?type=search&name=${encodeURIComponent(name)}`)
                        .then((response) => response.json())
                        .then((data) => {
                            if (data.length > 0) {
                                const studentData = data[0];
                                document.getElementById("student-info").innerHTML = `
                                    <p>剩餘課堂：${studentData.left}</p>
                                    <p>請假次數：${studentData.leave}</p>
                                `;
                            } else {
                                document.getElementById("student-info").innerHTML = "找不到該學生的資料。";
                            }
                        })
                        .catch((error) => {
                            document.getElementById("student-info").innerHTML = "查詢錯誤：" + error;
                        });
                } else {
                    document.getElementById("student-info").innerHTML = "請輸入完整的學生姓名。";
                }
            }

            // 請假功能
            function leaveStudent() {
                let name = document.getElementById("leave-name").value;
                if (name) {
                    fetch(url + `?type=leave&name=${encodeURIComponent(name)}`)
                        .then((response) => {
                            if (response.ok) {
                                alert(`${name} 請假成功！`);
                            } else {
                                alert(`${name} 請假失敗！`);
                            }
                        })
                        .catch((error) => {
                            alert("請假操作錯誤：" + error);
                        });
                } else {
                    alert("請輸入學生姓名！");
                }
            }

            // 調課功能
            function switchClass() {
                let name = document.getElementById("switch-name").value;
                let newClass = document.getElementById("switch-class").value;
                if (name) {
                    fetch(url + `?type=switch&name=${encodeURIComponent(name)}&newClass=${newClass}`)
                        .then((response) => {
                            if (response.ok) {
                                alert(`${name} 已經臨時調到 ${newClass} 班！`);
                            } else {
                                alert(`${name} 調課失敗！`);
                            }
                        })
                        .catch((error) => {
                            alert("調課錯誤：" + error);
                        });
                } else {
                    alert("請輸入學生姓名！");
                }
            }
        </script>
    </body>
</html>
