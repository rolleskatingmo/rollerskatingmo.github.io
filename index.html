<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>滾軸溜冰課程系統 - 家長入口</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { text-align: center; }
        input, button { margin: 10px 0; padding: 5px; }
        #result { margin-top: 20px; }
        .record { background: #f4f4f4; margin-bottom: 10px; padding: 10px; }
        #showMore { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>滾軸溜冰課程系統 - 家長入口</h1>
        <input type="text" id="studentName" placeholder="輸入學生姓名">
        <button onclick="searchStudent()">查詢</button>
        <div id="result"></div>
        <button id="showMore" onclick="showMoreRecords()">顯示更多</button>
    </div>
    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz9OZw14kE_znJEYptRmCxqYangawPJkb4ZTeCXkXTNMmdM8ji6L9veATl_f4z5-sw6Cg/exec';
        let allRecords = [];
        let currentDisplayed = 0;

        function searchStudent() {
            const name = document.getElementById('studentName').value;
            if (!name) {
                alert('請輸入學生姓名');
                return;
            }
            
            fetch(`${SCRIPT_URL}?action=getStudentDetails&name=${encodeURIComponent(name)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    displayResults(data);
                })
                .catch(error => {
                    document.getElementById('result').innerHTML = `<p>錯誤：${error.message}</p>`;
                });
        }

        function displayResults(data) {
            allRecords = [...data.classRecords, ...data.leaveRecords].sort((a, b) => new Date(b.date) - new Date(a.date));
            currentDisplayed = 0;
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<h2>${document.getElementById('studentName').value} 的記錄</h2>`;
            displayMoreRecords();
        }

        function displayMoreRecords() {
            const resultDiv = document.getElementById('result');
            const endIndex = Math.min(currentDisplayed + 10, allRecords.length);
            
            for (let i = currentDisplayed; i < endIndex; i++) {
                const record = allRecords[i];
                let recordHtml = `<div class="record">
                    <p>日期：${record.date}</p>`;

                if (record.time) {
                    recordHtml += `<p>時間：${record.time}</p>
                    <p>類型：上課</p>
                    <p>剩餘課堂數：${record.remainingClasses}</p>`;
                    if (record.classesChange) {
                        recordHtml += `<p>課堂數變更：${record.classesChange}</p>`;
                    }
                    if (record.reason) {
                        recordHtml += `<p>原因：${record.reason}</p>`;
                    }
                } else {
                    recordHtml += `<p>類型：請假</p>`;
                }

                recordHtml += `</div>`;
                resultDiv.innerHTML += recordHtml;
            }

            currentDisplayed = endIndex;
            document.getElementById('showMore').style.display = currentDisplayed < allRecords.length ? 'block' : 'none';
        }

        function showMoreRecords() {
            displayMoreRecords();
        }
    </script>
</body>
</html>
