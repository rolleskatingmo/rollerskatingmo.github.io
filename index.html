<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>簡易點名系統</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f9; }
    .container { margin: 20px; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .button { padding: 10px 20px; background-color: #007BFF; color: white; border: none; cursor: pointer; margin-top: 10px; }
    .button:hover { background-color: #0056b3; }
    .input { padding: 10px; width: 300px; margin: 5px 0; }
    label { font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h2>家長入口</h2>
    <label for="studentName">學員姓名：</label>
    <input type="text" id="studentName" class="input" placeholder="輸入學員姓名">
    <button class="button" onclick="queryRecord()">查詢記錄</button>
    <button class="button" onclick="changeClass()">調課</button>
    <button class="button" onclick="requestLeave()">請假</button>

    <h2>教練入口</h2>
    <label for="coachPassword">密碼：</label>
    <input type="password" id="coachPassword" class="input" placeholder="輸入密碼">
    <button class="button" onclick="verifyCoachPassword()">登錄</button>

    <div id="coachFunctions" style="display:none;">
      <button class="button" onclick="showClassStudents()">點名</button>
      <button class="button" onclick="addStudent()">新增學生</button>
      <button class="button" onclick="addClassHours()">新增課堂數</button>
    </div>
    
    <div id="studentButtons" style="margin-top:20px;"></div>  <!-- 顯示學生按鈕的地方 -->
  </div>

  <script>
    const scriptUrl = "https://script.google.com/macros/s/AKfycbwGt2Dtn-DgSXLYxAvUXdYJ5sru1kCkskOrh7vQ3f_smxhgV2-ZnByV0nOjVdEyTbrz/exec";

    // 查詢學員記錄
    function queryRecord() {
      var studentName = document.getElementById("studentName").value;
      const params = { studentName: studentName, action: 'queryRecord' };

      fetch(scriptUrl + '?' + new URLSearchParams(params))
        .then(response => response.json())
        .then(data => {
          if (data) {
            alert(`姓名: ${data.name}\n班級: ${data.class}\n剩餘課堂數: ${data.remainingClasses}\n請假次數: ${data.leaveCount}\n請假日期: ${data.leaveDates}`);
          } else {
            alert("未找到學員資料");
          }
        })
        .catch(error => console.error("Error fetching data: ", error));
    }

    // 調課功能
    function changeClass() {
      var studentName = document.getElementById("studentName").value;
      var newClass = prompt("請選擇調課班級：A1, A2, A3, A4, B1, B2, B3, B4, B5, B6, C1, C2");

      const params = { studentName: studentName, newClass: newClass, action: 'changeClass' };

      fetch(scriptUrl + '?' + new URLSearchParams(params))
        .then(response => response.json())
        .then(data => {
          alert(data.message);
        })
        .catch(error => console.error("Error fetching data: ", error));
    }

    // 請假功能
    function requestLeave() {
      var studentName = document.getElementById("studentName").value;
      var leaveDate = prompt("請輸入請假日期：");

      const params = { studentName: studentName, leaveDate: leaveDate, action: 'requestLeave' };

      fetch(scriptUrl + '?' + new URLSearchParams(params))
        .then(response => response.text())
        .then(data => {
          alert(data);
        })
        .catch(error => console.error("Error fetching data: ", error));
    }

    // 教練登入驗證
    function verifyCoachPassword() {
      var password = document.getElementById("coachPassword").value;
      const params = { password: password, action: 'checkCoachPassword' };

      fetch(scriptUrl + '?' + new URLSearchParams(params))
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            document.getElementById("coachFunctions").style.display = "block";
            alert("登錄成功");
          } else {
            alert("密碼錯誤");
          }
        })
        .catch(error => console.error("Error fetching data: ", error));
    }

    // 顯示班級學生列表並生成按鈕
    function showClassStudents() {
      var className = prompt("請輸入班級（A1, A2, A3, A4, B1, B2, B3, B4, B5, B6, C1, C2）：");

      const params = { className: className, action: 'getClassStudents' };

      fetch(scriptUrl + '?' + new URLSearchParams(params))
        .then(response => response.json())
        .then(students => {
          var studentButtons = document.getElementById("studentButtons");
          studentButtons.innerHTML = "";  // 清空之前的按鈕
          students.forEach(student => {
            var button = document.createElement("button");
            button.textContent = student;
            button.classList.add("button");
            button.onclick = () => markAttendance(student, className);
            studentButtons.appendChild(button);
          });
        })
        .catch(error => console.error("Error fetching data: ", error));
    }

    // 點名功能：扣減剩餘課堂數
    function markAttendance(studentName, className) {
      const params = { studentName: studentName, className: className, action: 'markAttendance' };

      fetch(scriptUrl + '?' + new URLSearchParams(params))
        .then(response => response.text())
        .then(data => {
          alert(data);  // 返回点名成功消息
        })
        .catch(error => console.error("Error fetching data: ", error));
    }

    // 新增學生功能
    function addStudent() {
      var name = prompt("請輸入學生姓名：");
      var className = prompt("請選擇班級：A1, A2, A3, A4, B1, B2, B3, B4, B5, B6, C1, C2");
      var numClasses = prompt("請輸入課堂數：");

      const params = { name: name, className: className, numClasses: numClasses, action: 'addStudent' };

      fetch(scriptUrl + '?' + new URLSearchParams(params))
        .then(response => response.text())
        .then(data => {
          alert(data);
        })
        .catch(error => console.error("Error fetching data: ", error));
    }

    // 新增課堂數功能
    function addClassHours() {
      var studentName = prompt("請輸入學生姓名：");
      var classHours = prompt("請輸入新增課堂數：");

      const params = { studentName: studentName, classHours: classHours, action: 'addClassHours' };

      fetch(scriptUrl + '?' + new URLSearchParams(params))
        .then(response => response.text())
        .then(data => {
          alert(data);
        })
        .catch(error => console.error("Error fetching data: ", error));
    }
  </script>
</body>
</html>
