<!doctype html>
<html lang="zh-TW">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>測試點名系統</title>
        <meta name="theme-color" content="3B4252" />
        <style>
            /* 保持不變，與您提供的 CSS 相同 */
        </style>
    </head>

    <body>
        <main>
            <h1>測試點名系統</h1>
            <h2 id="status">歡迎使用</h2>
            <nav>
                <button onclick="searchA()">查詢紀錄</button>
                <button onclick="callA()">點名</button>
                <button onclick="addA()">新增學生</button>
                <button onclick="classSwitch()">調課</button> <!-- 調課按鈕 -->
            </nav>
            <section>
                <div id="history">
                    <div class="search">
                        <input type="text" placeholder="輸入學生姓名查詢" id="search-name" />
                        <button onclick="searchStudent()">查詢課堂及請假次數</button>
                    </div>
                    <div id="student-info"></div>
                    <table>
                        <thead>
                            <tr>
                                <td>時間</td>
                                <td>剩下課堂</td>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div id="call">
                    <h2>載入中</h2>
                </div>
                <div id="add">
                    <div class="search">
                        <input type="text" id="add-name" placeholder="輸入學生姓名" />
                        <select id="class-select"> <!-- 班級選擇框 -->
                            <option value="A1">A1</option>
                            <option value="A2">A2</option>
                            <option value="A3">A3</option>
                            <option value="A4">A4</option>
                            <option value="B1">B1</option>
                            <option value="B2">B2</option>
                            <option value="B3">B3</option>
                            <option value="B4">B4</option>
                            <option value="B5">B5</option>
                            <option value="B6">B6</option>
                            <option value="C1">C1</option>
                            <option value="C2">C2</option>
                        </select>
                        <button onclick="addStudent()">新增</button>
                    </div>
                </div>
                <div id="leave">
                    <div class="search">
                        <input type="text" id="leave-name" placeholder="請假學生姓名" />
                        <button onclick="leaveStudent()">請假</button>
                    </div>
                </div>
                <div id="switch">
                    <div class="search">
                        <input type="text" id="switch-name" placeholder="輸入學生姓名" />
                        <select id="switch-class"> <!-- 調課班級選擇框 -->
                            <option value="A1">A1</option>
                            <option value="A2">A2</option>
                            <option value="A3">A3</option>
                            <option value="A4">A4</option>
                            <option value="B1">B1</option>
                            <option value="B2">B2</option>
                            <option value="B3">B3</option>
                            <option value="B4">B4</option>
                            <option value="B5">B5</option>
                            <option value="B6">B6</option>
                            <option value="C1">C1</option>
                            <option value="C2">C2</option>
                        </select>
                        <button onclick="switchClass()">調課</button>
                    </div>
                </div>
            </section>
            <footer>
                <a href="edit-mr.github.io/">毛哥EM</a>製作 |
                <a href="https://emtech.cc/post/roll-call">教學</a>
            </footer>
        </main>
        <script>
            // 更新的 URL
            var url =
                "https://script.google.com/macros/s/AKfycbw26iifZgP6xSuJYoxUqg1dYQ6hLk6bDS89bQd_hEKwVVrg4oZVG68G2d8H57I7vHU3/exec";

            const [history, call, add, leave, switchSection] = ["history", "call", "add", "leave", "switch"].map((t) =>
                    document.getElementById(t)
                );

            // 新增學生
            function addStudent() {
                let name = document.getElementById("add-name").value;
                let className = document.getElementById("class-select").value;
                if (name) {
                    fetch(url + `?type=new&name=${encodeURIComponent(name)}&class=${className}`)
                        .then((response) => {
                            if (response.ok) {
                                alert(`${name} 已成功加入 ${className} 班！`);
                            } else {
                                alert(`新增失敗`);
                            }
                        })
                        .catch((error) => {
                            alert("新增學生錯誤：" + error);
                        });
                } else {
                    alert("請輸入學生姓名！");
                }
            }

            // 查詢學生剩餘課堂數和請假次數
            function searchStudent() {
                let name = document.getElementById("search-name").value;
                if (name) {
                    fetch(url + `?type=search&name=${encodeURIComponent(name)}`)
                        .then((response) => response.json())
                        .then((data) => {
                            if (data.length > 0) {
                                const studentData = data[0]; // 假設只會返回一個學生的資料
                                document.getElementById("student-info").innerHTML = `
                                    <p>剩餘課堂：${studentData.left}</p>
                                    <p>請假次數：${studentData.leave}</p>
                                `;
                            } else {
                                document.getElementById("student-info").innerHTML = "找不到該學生的資料。";
                            }
                        })
                        .catch((error) => {
                            document.getElementById("student-info").innerHTML = "查詢錯誤：" + error;
                        });
                } else {
                    document.getElementById("student-info").innerHTML = "請輸入完整的學生姓名。";
                }
            }

            // 請假功能
            function leaveStudent() {
                let name = document.getElementById("leave-name").value;
                if (name) {
                    fetch(url + `?type=leave&name=${encodeURIComponent(name)}`)
                        .then((response) => {
                            if (response.ok) {
                                alert(`${name} 請假成功！`);
                            } else {
                                alert(`${name} 請假失敗！`);
                            }
                        })
                        .catch((error) => {
                            alert("請假操作錯誤：" + error);
                        });
                } else {
                    alert("請輸入學生姓名！");
                }
            }

            // 調課功能
            function switchClass() {
                let name = document.getElementById("switch-name").value;
                let newClass = document.getElementById("switch-class").value;
                if (name) {
                    fetch(url + `?type=switch&name=${encodeURIComponent(name)}&newClass=${newClass}`)
                        .then((response) => {
                            if (response.ok) {
                                alert(`${name} 已經臨時調到 ${newClass} 班！`);
                            } else {
                                alert(`${name} 調課失敗！`);
                            }
                        })
                        .catch((error) => {
                            alert("調課錯誤：" + error);
                        });
                } else {
                    alert("請輸入學生姓名！");
                }
            }
        </script>
    </body>
</html>
