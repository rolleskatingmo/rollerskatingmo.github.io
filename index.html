<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>簡易點名系統</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f9; }
    .container { margin: 20px; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .button { padding: 10px 20px; background-color: #007BFF; color: white; border: none; cursor: pointer; margin-top: 10px; }
    .button:hover { background-color: #0056b3; }
    .input { padding: 10px; width: 300px; margin: 5px 0; }
    label { font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h2>家長入口</h2>
    <label for="studentName">學員姓名：</label>
    <input type="text" id="studentName" class="input" placeholder="輸入學員姓名">
    <button class="button" onclick="queryRecord()">查詢記錄</button>
    <button class="button" onclick="changeClass()">調課</button>
    <button class="button" onclick="requestLeave()">請假</button>

    <h2>教練入口</h2>
    <label for="coachPassword">密碼：</label>
    <input type="password" id="coachPassword" class="input" placeholder="輸入密碼">
    <button class="button" onclick="verifyCoachPassword()">登錄</button>

    <div id="coachFunctions" style="display:none;">
      <button class="button" onclick="showClassStudents()">點名</button>
      <button class="button" onclick="addStudent()">新增學生</button>
      <button class="button" onclick="addClassHours()">新增課堂數</button>
    </div>
    
    <div id="studentButtons" style="margin-top:20px;"></div>  <!-- 顯示學生按鈕的地方 -->
  </div>

  <script>
    const scriptUrl = "https://script.google.com/macros/s/AKfycbyCygfKQyI-hjr4s0djt96tunLfjp8XL7A-VWcf4wXP-khmFPB1jU3ZDVLDMFAMFmmdIQ/exec";

    // 教練登入驗證
    function verifyCoachPassword() {
      var password = document.getElementById("coachPassword").value;
      const params = { password: password, action: 'checkCoachPassword' };

      fetch(scriptUrl + '?' + new URLSearchParams(params))
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            document.getElementById("coachFunctions").style.display = "block";
            alert("登錄成功");
          } else {
            alert("密碼錯誤");
          }
        })
        .catch(error => console.error("Error fetching data: ", error));
    }

    // 顯示班級學生列表並生成按鈕
    function showClassStudents() {
      var className = prompt("請輸入班級（A1, A2, A3, A4, B1, B2, B3, B4, B5, B6, C1, C2）：");

      const params = { className: className, action: 'getClassStudents' };

      fetch(scriptUrl + '?' + new URLSearchParams(params))
        .then(response => response.json())
        .then(students => {
          var studentButtons = document.getElementById("studentButtons");
          studentButtons.innerHTML = "";  // 清空之前的按鈕
          students.forEach(student => {
            var button = document.createElement("button");
            button.textContent = student;
            button.classList.add("button");
            button.onclick = () => markAttendance(student, className, false); // 默認顯示點名按鈕
            studentButtons.appendChild(button);
          });
        })
        .catch(error => console.error("Error fetching data: ", error));
    }

    // 點名功能：扣減剩餘課堂數並標記顏色
    function markAttendance(studentName, className, isChangedClass) {
      const params = { studentName: studentName, className: className, action: 'markAttendance', isChangedClass: isChangedClass };

      fetch(scriptUrl + '?' + new URLSearchParams(params))
        .then(response => response.text())
        .then(data => {
          alert(data);  // 返回点名成功消息
          // 點名後將按鈕變為綠色
          var buttons = document.querySelectorAll("button");
          buttons.forEach((button) => {
            if (button.textContent === studentName) {
              button.style.backgroundColor = 'green';
            }
          });
        })
        .catch(error => console.error("Error fetching data: ", error));
    }

  </script>
</body>
</html>
